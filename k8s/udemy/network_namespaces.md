# Network Namespaces

## Namespace

Network NamespaceëŠ” Docker ì™€ ê°™ì€ ì»¨í…Œì´ë„ˆì— ì˜í•´ êµ¬í˜„ëœ Network Isolation ì„

ì»¨í…Œì´ë„ˆëŠ” í˜¸ìŠ¤íŠ¸ì—ì„œ Namespaceë¡œ ë¶„ë¦¬ëœ ê³µê°„

í˜¸ìŠ¤íŠ¸ê°€ í•˜ë‚˜ì˜ ì§‘ì´ë¼ë©´, ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” ìì‹ë“¤ì´ í• ë‹¹ë˜ëŠ” ê³µê°„ì„

```
+----------------------------+
|   +-------+   +-------+    |
|   |   ğŸ‘¶ğŸ»  |   |   ğŸ‘§ğŸ»  |    |
|   |       |   |       |    |
|   +-------+   +-------+    |
|   +--------+   +------+    |
|   |   ğŸ§’ğŸ»  |    |  ğŸ‘¦ğŸ»  |    |
|   |       |    |      |    |
|   +--------+   +------+    |
|                            |
|        ğŸ‘©ğŸ¼â€ğŸ¦°ğŸ‘¨ğŸ½â€ğŸ¦° Parent         |
+----------------------------+
```

ê° ë°©ë“¤ì€ ê° ì•„ì´ë“¤ì´ ê°œì¸ ê³µê°„ì„ ë³´ì¥í•´ ì£¼ëŠ” ê³µê°„ìœ¼ë¡œ, ê°ìì˜ ì˜ì—­ì„ ë³¼ ìˆ˜ ì—†ìŒ

ë§ˆì¹˜ ê° ì•„ì´ë“¤ì´ ê·¸ ë°©ì´ ì „ì²´ì˜ ì§‘ì¸ ê²ƒì²˜ëŸ¼ ëŠë¼ê²Œ í•´ì¤Œ

í•˜ì§€ë§Œ, ë¶€ëª¨ëŠ” í•´ë‹¹ ë°©ë“¤ì„ í¬í•¨í•œ ëª¨ë“  ê³µê°„ì„ ë³¼ ìˆ˜ ìˆìŒ

ì´ ë•Œ ë‘ ë°©ì„ ì—°ê²°í•˜ê³  ì‹¶ë‹¤ë©´?

<br>

### Process Namespace

Namespaceë¥¼ í†µí•´ì„œ ì´ ì—°ê²°ì„ ìœ„í•œ ìƒˆë¡œìš´ ê³µê°„ì„ ìƒì„±í•˜ê³ , ì´ ê³µê°„ì€ í˜¸ìŠ¤íŠ¸ ìœ„ ë‹¤ë¥¸ ê³µê°„ì´ë‚˜ ì»¨í…Œì´ë„ˆë¥¼ ë³¼ ìˆ˜ ì—†ìŒ

ì´ ê³µê°„ì€ ì˜¤ì§ í•´ë‹¹ ê³µê°„ì—ì„œ ì¼ì–´ë‚˜ëŠ” í”„ë¡œì„¸ì‹±ë§Œì„ ë³¼ ìˆ˜ ìˆìœ¼ë©°, í•´ë‹¹ ê³µê°„ì´ í˜¸ìŠ¤íŠ¸ ê·¸ ìì²´ë¼ê³  ê³ ë ¤í•  ìˆ˜ ìˆê²Œ ë¨

í•˜ì§€ë§Œ ì‹¤ì œ í˜¸ìŠ¤íŠ¸ëŠ” ëª¨ë“  í”„ë¡œì„¸ìŠ¤ ì§„í–‰ ì‚¬í•­ì„ ë³¼ ìˆ˜ ìˆìŒ 

`ps aux` ëª…ë ¹ì–´ë¥¼ í†µí•´ ì‹¤í–‰ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ í™•ì¸ ê°€ëŠ¥

<br>

**âœ”ï¸ On the Container**

```bash
â¯ ps aux
USER               PID  %CPU %MEM      VSZ    RSS   TTY  STAT STARTED      TIME COMMAND
root                 1   0.0  0.0     4238    828   ?    Ss   03:06        0:00 nginx
```

**âœ”ï¸ On the Host**

<pre><code lang="bash">â¯ ps aux
USER               PID  %CPU %MEM      VSZ    RSS   TTY  STAT STARTED      TIME COMMAND
project           3270   0.1  0.1    99580   4916   ?    R    06:06        0:00 sshd: project@pts/0
project           3225   0.0  0.1    95196   4916   ?    S    06:06        0:00 sshd: project@ notty
project           3270   0.1  0.1    21352   4916   ?    Ss   06:06        0:00 -bash
<b>root              3816   1.0  0.1     4528    828   ?    Ss   06:06        0:00 nginx</b>
</code></pre>

ê° Containerì—ì„œ ì‹¤í–‰ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ëª¨ë‘ í™•ì¸í•  ìˆ˜ ìˆìŒ

ì´ ë•Œ, ì»¨í…Œì´ë„ˆì™€ í˜¸ìŠ¤íŠ¸ ìƒì—ì„œ ì‹¤í–‰ë˜ëŠ” PID (Process ID) ê°€ ì„œë¡œ ë‹¤ë¦„ì„ ì•Œ ìˆ˜ ìˆìŒ â†’ Namespace ê°€ ìˆ˜í–‰ë˜ëŠ” ë°©ì‹

---

í˜¸ìŠ¤íŠ¸ ìì²´ì˜ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ê°€ ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°ë˜ì–´ ìˆê³ ,
í˜¸ìŠ¤íŠ¸ ìì²´ì—ì„œ ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ì •ë³´ë¥¼ ê°€ì§„ ë¼ìš°íŒ… í…Œì´ë¸”ê³¼ ARP í…Œì´ë¸”ì„ ê°–ê³  ìˆì„ ë•Œ


ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë  ë•ŒëŠ” í•´ë‹¹ ì»¨í…Œì´ë„ˆ ìì²´ì˜ ë¼ìš°íŒ… í…Œì´ë¸”ê³¼ ARP í…Œì´ë¸”ì´ ìƒì„±ë¨

ê·¸ë¦¬ê³  ê·¸ ì»¨í…Œì´ë„ˆë§Œì˜ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê°€ì§

```
+-----------------------------------------+
|                   Host                  |
|                                         |
|     +----------------------------+      |
|     |          Container         |      |
|     |                            |      |
|     |  +---------+ +-------+     |      |
|     |  | Rouitng | |  ARP  |     |      |
|     |  |  Table  | | Table |  [veth0]   |
|     |  +---------+ +-------+     |      |
|     |                            |      |                      +----------------+
|     +----------------------------+      |                      |                |
|                                         |  192.168.1.2         |      LAN       |
|                                       [eth0]-------------------+   192.168.1.0  |
|       +---------+ +-------+             |                      |                |
|       | Rouitng | |  ARP  |             |                      +----------------+
|       |  Table  | | Table |             |
|       +---------+ +-------+             |
+-----------------------------------------+
```

---

<br>

### Create Network NS

Linux Host ì—ì„œ Network Namespaceë¥¼ ìƒì„±í•˜ë ¤ë©´ `ip netns add` ëª…ë ¹ì–´ ì‚¬ìš©

```bash
$ ip netns add <<network_namespace_name>>
# example
ip netns add red
ip netns add blue
```

Network Namespace ëª©ë¡ì„ í™•ì¸í•˜ë ¤ë©´ `ip netns` ëª…ë ¹ì–´ ì‚¬ìš©

```bash
$ ip netns
red
blue
```

Network ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¸í•˜ê³ ì í•œë‹¤ë©´ `ip link` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

```bash
ip link
```

<br>

### Exec in Network NS

ê·¸ëŸ¼ í˜¸ìŠ¤íŠ¸ê°€ ê°€ì§„ loopback ì¸í„°í˜ì´ìŠ¤ì™€ `eth0` ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŒ

ìƒì„±í•œ Network Namespace ë‚´ì—ì„œ ì´ ëª¨ë“  ê²ƒì„ í™•ì¸í•˜ê³  ì‹¶ì„ ë•ŒëŠ” ë‘ ê°€ì§€ ë°©ë²•ì´ ìˆìŒ

<br>

**âœ”ï¸ 1. `ip netns exec <<ns_name>> ...`**

ëª…ë ¹ì–´ ì•ì— prefix ë¡œ `ip netns exec <<ns_name>> ` ì…ë ¥ í›„ í˜¸ìŠ¤íŠ¸ì—ì„œ ì…ë ¥í•˜ëŠ” ê²ƒê³¼ ë™ì¼í•˜ê²Œ ì‚¬ìš©

ê°€ë ¹, `red` ë¼ëŠ” ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ì—ì„œ Network ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¸í•˜ê³  ì‹¶ë‹¤ë©´, ì•„ë˜ì™€ ê°™ì´ ì…ë ¥

<pre><code lang="bash">â¯ <b>ip netns exec red</b> ip link
</code></pre>

<br>

**âœ”ï¸ 2. `ip -n <<ns_name>> ...`**

í˜¹ì€ `-n` ì˜µì…˜ì„ ì§€ì •

<pre><code lang="bash">â¯ ip <b>-n red</b> link
</code></pre>

ìœ„ ëª…ë ¹ì–´ëŠ” ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ì—ì„œ ì‹¤í–‰ë˜ë©°, loopback ì¸í„°í˜ì´ìŠ¤ë§Œ í™•ì¸ ê°€ëŠ¥í•˜ê³ , eth0 ì¸í„°í˜ì´ìŠ¤ëŠ” í™•ì¸ ë¶ˆê°€

ARPì™€ Routing Table ë„ ë™ì¼í•˜ê²Œ ì‘ë™

```bash
â¯ arp
...
â¯ route
...
```

ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ì—ì„œ `arp` ë‚˜ `route` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ì–´ë–¤ ë°ì´í„°ë„ ë³´ì´ì§€ ì•ŠìŒ

---

ê·¸ë˜ì„œ ì´ˆê¸° ì»¨í…Œì´ë„ˆë“¤ì€ ì²˜ìŒì— ì—°ê²°ì´ ë¶ˆê°€ (Connectivity âŒ)

```
+----------------------------------------+
|                  Host                  |
|                                        |
|   +----------+         +-----------+   |
|   |          |         |           |   |
|   |          |         |           |   |
|   |          |         |           |   |
|   +----------+         +-----------+   |
|                                      [eth0]
|                                        |
+----------------------------------------+
```

ì—°ê²°í•˜ê³ ì í•œë‹¤ë©´, ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì‚¬ì´ì˜ ì—°ê²°ì´ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •

ë¬¼ë¦¬ ì»´í“¨í„°ë¥¼ ì—°ê²°í•˜ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•œ ë°©ì‹ìœ¼ë¡œ Virtual Ethernet Pair` ì´ë‚˜ Virtual cable (Pipe) ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

<br>

**âœ”ï¸ 1. ì¼€ì´ë¸” ìƒì„±**

ì„œë¡œ ì—°ê²°ëœ í•œ ìŒì˜ veth ìƒì„±

<pre><code lang="bash">â¯ ip link add <b>veth-red</b> type veth peer name <b>veth-blue</b></code></pre>

```
+----------------------------------------+
|                  Host                  |
|   +----------+         +-----------+   |
|   |          |         |           |   |
|   |          |         |           |   |
|   |          |         |           |   |
|   +----------+  Ready  +-----------+   |
|        [veth-red]----[veth-blue]     [eth0]
+----------------------------------------+
```

<br>

**âœ”ï¸ 2. ë„¤íŠ¸ì›Œí¬ Namespace í• ë‹¹**

ê·¸ ë‹¤ìŒ ìƒì„±í•œ vethë¥¼ ê°ê°ì˜ ë„¤íŠ¸ì›Œí¬ Namespaceì— í• ë‹¹

<pre><code lang="bash">
â¯ ip link set <b>veth-red</b> netns <b>red</b>
â¯ ip link set <b>veth-blue</b> netns <b>blue</b>
</code></pre>

```
+-----------------------------------------+
|                   Host                  |
|   +-----------+         +-----------+   |
|   |           |  Ready  |           |   |
|   |    [veth-red]-----[veth-blue]   |   |
|   |           |         |           |   |
|   +-----------+         +-----------+   |
|                                       [eth0]
+-----------------------------------------+
```

<br>

**âœ”ï¸ 3. ë„¤íŠ¸ì›Œí¬ Namespace ì— IP í• ë‹¹**

<pre><code lang="bash">
â¯ ip -n <b>red</b> addr add 192.168.15.1 dev <b>veth-red</b>
â¯ ip -n <b>blue</b> addr add 192.168.15.2 dev <b>veth-blue</b>
</code></pre>

```
+------------------------------------------------------+
|                          Host                        |
|   +----------------+            +----------------+   |
|   |                |    Ready   |                |   |
|   |          [veth-red]-------[veth-blue]        |   |
|   |   192.168.15.1 |            |  192.168.15.2  |   |
|   +----------------+            +----------------+   |
|                                                    [eth0]
+------------------------------------------------------+
```

<br>

**âœ”ï¸ 4. link set up**

ê° ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ì˜ ê° ì¥ì¹˜ì— ëŒ€í•´ ip link setup ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‹œì‘

ë§í¬ê°€ ì˜¬ë¼ì™”ê³  ì´ì œ ì´ë¦„ ê³µê°„ì´ ì„œë¡œ ì—°ê²°ë  ìˆ˜ ìˆìŒ

<pre><code lang="bash">
â¯ ip -n <b>red</b> addr add 192.168.15.1 dev <b>veth-red</b>
â¯ ip -n <b>blue</b> addr add 192.168.15.2 dev <b>veth-blue</b>
</code></pre>

```
+------------------------------------------------------+
|                          Host                        |
|   +----------------+            +----------------+   |
|   |                |  ğŸ”—Active  |                |   |
|   |          [veth-red]=======[veth-blue]         |   |
|   |   192.168.15.1 |            |  192.168.15.2  |   |
|   +----------------+            +----------------+   |
|                                                    [eth0]
+------------------------------------------------------+
```

ì´ì œ ì„œë¡œì—ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŒ

<br>

**âœ”ï¸ 5. connection test**

ì„œë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì‚¬ì‹¤ì„ í…ŒìŠ¤íŠ¸

```
â¯ ping netns exec red ping 192.168.15.2
PING 192.168.15.2(192.168.15.2) 56 data bytes
64 bytes from 192.168.15.2: icmp_seq=1 ttl=56 time=0.056 ms
```

ë˜í•œ, redì™€ blueì—ì„œ ê°ê° arp ë¥¼ í™•ì¸í•´ë³´ë©´ ì„œë¡œì˜ MAC Addressë¥¼ ë“±ë¡í•˜ê³  ìˆìŒ

```
â¯ ping netns exec red arp
Address         HWtype  HWaddress           Flags Mask      Iface
192.168.15.2    ether   ba:b0:6d:68:09:e9   C               veth-red
```

```
â¯ ping netns exec blue arp
Address         HWtype  HWaddress           Flags Mask      Iface
192.168.15.2    ether   ba:b0:6d:68:09:e9   C               veth-red
```

í•˜ì§€ë§Œ í˜¸ìŠ¤íŠ¸ì˜ ARP ë¥¼ ì‚´í´ë³´ë©´ ì•„ë¬´ê²ƒë„ ì•Œê³  ìˆì§€ ì•ŠìŒ

```
â¯ arp
Address         HWtype  HWaddress           Flags Mask      Iface
192.168.1.3     ether   52:54:00:12:35:03   C               eth0
192.168.1.4     ether   52:54:00:12:35:04   C               eth0
```

<td><img src="./img/network_namespaces_img1.png" width="70%"></td>

### Delete Link

ìƒì„±í•œ ë§í¬ ì‚­ì œ

ë§í¬ì˜ í•œ ìª½ë§Œ ì‚­ì œí•´ë„ ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ìë™ìœ¼ë¡œ ì‚­ì œë¨ 

```Bash
ip -n red link del veth-red
```

`veth-red` ë¥¼ ì œê±°í–ˆê¸° ë•Œë¬¸ì—, ì—°ê²°ë˜ì–´ ìˆë˜ `veth-blue` ëŠ” ìë™ìœ¼ë¡œ ì œê±°ë¨

---

ë” ë§ì€ ê°€ìƒ í™˜ê²½ì´ ì—°ê²°í•˜ê³ ì í•  ë•ŒëŠ” ê°€ìƒ Switchë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ 

Linux bridge, Open V switch ê°™ì€ ê°€ìƒ ìŠ¤ìœ„ì¹˜ë¥¼ ì œê³µí•˜ëŠ” ë‹¤ì–‘í•œ ì†”ë£¨ì…˜ì´ ì¡´ì¬

Linux bridge ë¡œ ì‚´í´ë³´ë©´ ì•„ë˜ì˜ ê³¼ì •ì„ ë”°ë¦„

<br>

**âœ”ï¸ 1. ìƒˆë¡œìš´ ì¸í„°í˜ì´ìŠ¤ ìƒì„±**

`v-net-0` ë¼ëŠ” ê°€ìƒ ì¸í„°í˜ì´ìŠ¤ ìƒì„±

```
â¯ ip link add v-net-0 type bridge
```

ì´ëŠ” ip link ì—ì„œ ë…¸ì¶œë˜ëŠ” brige íƒ€ì…ì˜ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì„ 

```
â¯ ip link
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state
UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc
fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 02:0d:31:14:c7:a7 brd ff:ff:ff:ff:ff:ff
6: v-net-0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN
mode DEFAULT group default qlen 1000
    link/ether 06:9d:69:52:6f:61 brd ff:ff:ff:ff:ff:ff
```

<br>

**âœ”ï¸ 1. ì¸í„°í˜ì´ìŠ¤ set up**

<pre><code>â¯ ip link set <b>v-net-0</b> up</code></pre>

ì´ë¥¼ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ìœ„í•œ í•˜ë‚˜ì˜ Switch ë¡œ ë³¼ ê²ƒì„

```
+------------------------------------------------------------------------------------+
|                                          Host                                      |
|   +----------------+            +----------------+            +----------------+   |
|   |       Red      |            |  192.168.15.0  |            |      Blue      |   |
|   |                |            |     v-net-0    |            |                |   |
|   |                |            |                |            |                |   |
|   +----------------+            +----------------+            +----------------+   |
|                                                                                  [eth0]
+------------------------------------------------------------------------------------+
```

<br>

**âœ”ï¸ 2. Virtual Bridge ì—°ê²°í•  ìƒˆë¡œìš´ veth ìŒ ìƒì„±**

<pre><code>â¯ ip link add <b>veth-red</b> type veth peer name <b>veth-red-br</b>
â¯ ip link add <b>veth-blue</b> type veth peer name <b>veth-blue-br</b>
</code></pre>

```
+------------------------------------------------------------------------------------+
|                                          Host                                      |
|   +----------------+            +----------------+            +----------------+   |
|   |       Red      |            |  192.168.15.0  |            |      Blue      |   |
|   |                |            |     v-net-0    |            |                |   |
|   |                |            |                |            |                |   |
|   +----------------+            +----------------+            +----------------+   |
|             [veth-red]----[veth-red-br]   [veth-blue-br]----[veth-blue]            |
|                                                                                  [eth0]
+------------------------------------------------------------------------------------+
```

<br>

**âœ”ï¸ 3. veth ì—°ê²°**

<pre><code>â¯ ip link set <b>veth-red</b> netns <b>red</b>
â¯ ip link set <b>veth-red-br</b> netns <b>v-net-0</b>
â¯ ip link set <b>veth-blue</b> netns <b>blue</b>
â¯ ip link set <b>veth-blue-br</b> netns <b>v-net-0</b>
</code></pre>

```
+------------------------------------------------------------------------------------+
|                                          Host                                      |
|   +----------------+            +----------------+            +----------------+   |
|   |       Red      |            |  192.168.15.0  |            |      Blue      |   |
|   |                |            |     v-net-0    |            |                |   |
|   |                |            |                |            |                |   |
|   |        [veth-red]----[veth-red-br]     [veth-blue-br]----[veth-blue]       |   |
|   +----------------+            +----------------+            +----------------+   |
|                                                                                  [eth0]
+------------------------------------------------------------------------------------+
```

<br>

**âœ”ï¸ 4. IP í• ë‹¹**

<pre><code>â¯ ip -n <b>red</b> add <b>192.168.15.1</b> dev <b>veth-red</b>
â¯ ip -n <b>blue</b> add <b>192.168.15.2</b> dev <b>veth-blue</b>
</code></pre>

```
+------------------------------------------------------------------------------------+
|                                          Host                                      |
|   +----------------+            +----------------+            +----------------+   |
|   |       Red      |            |  192.168.15.0  |            |      Blue      |   |
|   |                |            |     v-net-0    |            |                |   |
|   |   192.168.15.1 |            |                |            | 192.168.15.2   |   |
|   |        [veth-red]----[veth-red-br]     [veth-blue-br]----[veth-blue]       |   |
|   +----------------+            +----------------+            +----------------+   |
|                                                                                  [eth0]
+------------------------------------------------------------------------------------+
```

<br>

**âœ”ï¸ 4. link set up**

<pre><code>â¯ ip -n <b>red</b> link set <b>veth-red</b> up
â¯ ip -n <b>blue</b> link set <b>veth-blue</b> up
</code></pre>

```
+------------------------------------------------------------------------------------+
|                                          Host                                      |
|   +----------------+            +----------------+            +----------------+   |
|   |       Red      |            |  192.168.15.0  |            |      Blue      |   |
|   |                |            |     v-net-0    |            |                |   |
|   |   192.168.15.1 |  Active    |                |    Active  | 192.168.15.2   |   |
|   |        [veth-red]=====[veth-red-br]   [veth-blue-br]====[veth-blue]        |   |
|   +----------------+            +----------------+            +----------------+   |
|                                                                                  [eth0]
+------------------------------------------------------------------------------------+
```

ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ ë¶„ë¦¬í•œ í™˜ê²½ì„ ëª¨ë‘ ì—°ê²°í•  ìˆ˜ ìˆìŒ

<br><img src="./img/network_namespaces_img2.png" width="40%"><br>

`v-net-0` ëŠ” ì‹¤ì œ í˜¸ìŠ¤íŠ¸ì—ì„œ ìƒì„±í•œ ì¸í„°í˜ì´ìŠ¤ì´ê¸° ë•Œë¬¸ì—, ì´ì œ ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì—ì„œë„ ê°€ìƒ í™˜ê²½ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŒ

```Bash
â¯ ping 192.168.15.1
PING 192.168.15.1 (192.168.15.1) 56(84) bytes of data.
64 bytes from 192.168.15.1: icmp_seq=1 ttl=64 time=0.026 ms
```

í•˜ì§€ë§Œ, ì•„ì§ ì´ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±ì€ ë¡œì»¬ í˜¸ìŠ¤íŠ¸ì— í•œí•´ ì œí•œì ìœ¼ë¡œ ì˜¤í”ˆë˜ì–´ ìˆìœ¼ë©°, ì™¸ë¶€ì™€ëŠ” ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŒ

---

LAN ë°–ì˜ ì™¸ë¶€ ì»´í“¨í„°ì—ì„œ ì´ ê°€ìƒ í™˜ê²½ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥

```Bash
â¯ ip netns exec blue ping 192.168.1.3
Connect: Network is unreachable

â¯ ip netns exec blue route
Destination     Gateway         Genmask         Flags   Metric  Ref   Use   Iface
192.168.15.0    0.0.0.0         255.255.255.0   U       0       0       0   veth-blue
```

ì´ ë•Œ, ë¼ìš°í„°ë¥¼ ì´ìš©í•´ ì™¸ë¶€ í™˜ê²½ê³¼ ì—°ê²°í•  ìˆ˜ ìˆìŒ

<br><img src="./img/network_namespaces_img3.png" width="80%"><br>

ì´ì œ blue ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™˜ê²½ì—ì„œ ê²Œì´íŠ¸ì›¨ì´ë¥¼ ê±°ì³ ë°–ì— ì—°ê²°ë  ìˆ˜ ìˆë„ë¡ ì„¤ì •

```Bash
â¯ ip netns exec blue ip route add 192.168.1.0/24 via 192.168.15.5
Destination     Gateway         Genmask         Flags   Metric  Ref   Use   Iface
192.168.15.0    0.0.0.0         255.255.255.0   U       0       0       0   veth-blue
192.168.1.0     192.168.15.5    255.255.255.0   UG      0       0       0   veth-blue
```

`192.168.15.5` ë¥¼ ê²½ìœ í•´ì„œ  `192.168.1.0/24` ëŒ€ì—­ì— ì ‘ê·¼í•˜ë„ë¡ ì„¤ì •

blue ì—ì„œ ë°–ìœ¼ë¡œ í–¥í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ ì—´ì—ˆê³ , ì´ì œ ë°˜ëŒ€ë¡œ ì¸ì…ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ ì—´ì–´ì•¼ í•¨

```Bash
â¯ iptables -t nat -A POSTROUTING -s 192.168.15.0/24 -j MASQUERADE
```

`192.168.15.0/24` ë„¤íŠ¸ì›Œí¬ì—ì„œ ë‚˜ê°€ëŠ” íŒ¨í‚·ë“¤ì˜ ì¶œë°œì§€ IP ì£¼ì†Œë¥¼, ë¼ìš°í„°ì˜ í¼ë¸”ë¦­ IP ì£¼ì†Œë¡œ ë³€ê²½í•˜ëŠ” NAT ê·œì¹™ì„ ì¶”ê°€

ì´ë¥¼ í†µí•´ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì˜ ì—¬ëŸ¬ ì¥ì¹˜ê°€ í•˜ë‚˜ì˜ ê³µì¸ IP ì£¼ì†Œë¥¼ í†µí•´ ì¸í„°ë„·ì— ì ‘ì†í•  ìˆ˜ ìˆìŒ

- `iptables`: ë¦¬ëˆ…ìŠ¤ ë°©í™”ë²½ ì„¤ì • ê´€ë¦¬ ëª…ë ¹ì–´
- `-t nat`: NAT í…Œì´ë¸” ì§€ì • (NAT í…Œì´ë¸”ì€ íŒ¨í‚· ì£¼ì†Œ ë³€í™˜ì— ì‚¬ìš©)
- `-A POSTROUTING`: POSTROUTING ì²´ì¸ì— ê·œì¹™ì„ ì¶”ê°€. `POSTROUTING` ì²´ì¸ì€ íŒ¨í‚·ì´ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ë‚˜ê°€ëŠ” ì‹œì ì— ì ìš©.
- `-s 192.168.15.0/24`: ì¶œë°œì§€ ì£¼ì†Œê°€ `192.168.15.0/24` ë„¤íŠ¸ì›Œí¬ì— ì†í•˜ëŠ” íŒ¨í‚·ì— ëŒ€í•´ ì´ ê·œì¹™ì„ ì ìš©
- `-j MASQUERADE`: íŒ¨í‚·ì˜ ì¶œë°œì§€ IP ì£¼ì†Œë¥¼ ë³€ê²½í•˜ë„ë¡ ì§€ì •. `MASQUERADE`ëŠ” ë™ì ìœ¼ë¡œ IP ì£¼ì†Œë¥¼ ë³€í™˜í•˜ì—¬, ì£¼ë¡œ ë™ì  IP í• ë‹¹ í™˜ê²½ì—ì„œ ì‚¬ìš©.

<br><img src="./img/network_namespaces_img4.png" width="80%"><br>

ì´ì œ í˜¸ìŠ¤íŠ¸ê°€ ë‹¿ì„ ìˆ˜ ìˆëŠ” ì™¸ë¶€ í™˜ê²½ì— ëª¨ë‘ ì ‘ê·¼í•  ìˆ˜ ìˆìŒ

í•˜ì§€ë§Œ, ì™¸ë¶€ì—ì„œ ì»¨í…Œì´ë„ˆì— ì§ì ‘ ì—°ê²°í•  ë°©ë²•ì€ ì—†ìŒ â†’ í˜¸ìŠ¤íŠ¸ë¥¼ í†µí•´ì•¼í•¨

**ì™¸ë¶€ì—ì„œ íŠ¹ì • ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™˜ê²½ì— ë‹¿ì„ ìˆ˜ ìˆëŠ” ë‘ ê°€ì§€ ë°©ë²•**

1. í˜¸ìŠ¤íŠ¸ IPì— ì ‘ê·¼í•˜ë©´ íŠ¹ì • ê°€ìƒ í™˜ê²½ IP ë¥¼ ë§¤ì¹­í•´ ì „ë‹¬
2. Port forwarding: `iptables -t nat -A PREROUTING --dport 80 --to-destination 192.168.15.2:80 -j DNAT`




Network Namespaceë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë™ì•ˆ í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ë‹¤ë¥¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ pingì„ ìˆ˜í–‰í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ë©´,
IP Addressë¥¼ ì„¤ì •ì˜ `NETMASK`ë¥¼ í™•ì¸. 
ì¦‰, 192.168.1.10/24

```
ip -n red addr add 192.168.1.10/24 dev veth-red
```

í˜¹ì€ FirewallD/IP Table ê·œì¹™ í™•ì¸

í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ë‹¤ë¥¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ê¸° ìœ„í•´
IP Tableì— ê·œì¹™ì„ ì¶”ê°€í•˜ê±°ë‚˜ IP Tableì„ ëª¨ë‘ ë¹„í™œì„±í™” (ì‹¤ìŠµ í•œì •)






